---
// MapLocation.astro
// Usage: <MapLocation lat={44.7469} lng={21.0731} label="Karađorđeva 34A 3, Veliko Gradište" zoom={15} />

interface Props {
  lat: number;
  lng: number;
  label?: string;
  zoom?: number;
}

const { lat, lng, label = "View on map", zoom = 15 } = Astro.props;

// Google Maps static image (no API key needed for basic use)
// Uses OpenStreetMap static tiles as a free alternative
const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}&z=${zoom}`;
const staticMapUrl = `https://maps.googleapis.com/maps/api/staticmap?center=${lat},${lng}&zoom=${zoom}&size=400x200&markers=color:red%7C${lat},${lng}&scale=2`;

// Free alternative using OpenStreetMap (no API key required)
const osmStaticUrl = `https://staticmap.openstreetmap.de/staticmap.php?center=${lat},${lng}&zoom=${zoom}&size=400x200&markers=${lat},${lng},red-pushpin`;
---

<a
  href={mapsUrl}
  target="_blank"
  rel="noopener noreferrer"
  class="map-card"
  aria-label={`Open ${label} in Google Maps`}
>
  <div class="map-preview">
    <!-- Embedded iframe preview (free, no API key) -->
    <iframe
      src={`https://www.openstreetmap.org/export/embed.html?bbox=${lng - 0.005},${lat - 0.003},${lng + 0.005},${lat + 0.003}&layer=mapnik&marker=${lat},${lng}`}
      loading="lazy"
      title={label}
    ></iframe>
    <div class="map-overlay">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
      Prikaži na mapi
    </div>
  </div>
  {label && <p class="map-label">{label}</p>}
</a>

<style>
  .map-card {
    
    display: inline-block;
    text-decoration: none;
    color: inherit;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    max-width: 1050px;
    width: 100%;
    
  }

  .map-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  }

  .map-preview {
    
    position: relative;
    height: 180px;
    overflow: hidden;
    background: #e8e0d8;
    cursor: pointer;
  }

  .map-preview iframe {
    width: 100%;
    height: 100%;
    border: none;
    pointer-events: none; /* prevent iframe from capturing clicks */
  }

  .map-overlay {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    color: #333;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    white-space: nowrap;
  }

  .map-label {
    margin: 0;
    padding: 10px 14px;
    font-size: 13px;
    color: #555;
    background: white;
    border-top: 1px solid #eee;
  }
</style>